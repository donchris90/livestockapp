<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Livestock Marketplace</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://kit.fontawesome.com/a2c7c9e14a.js" crossorigin="anonymous"></script>
    <!-- Add in <head> -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
      .product-card .badge {
  font-size: 0.75rem;
  padding: 0.35em 0.6em;
  border-radius: 0.5rem;
  font-weight: 600;
}

.badge-featured {
  background-color: gold;
  color: black;
}

.badge-boosted {
  background-color: #17a2b8;
  color: white;
}

.badge-verified {
  background-color: #28a745;
  color: white;
}

    .price {
      font-weight: bold;
      color: #28a745;
    }
    .sidebar {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
    }
    .product-card {
      transition: transform 0.2s ease-in-out;
    }
    .product-card:hover {
      transform: scale(1.03);
    }
    .product-img {
      height: 200px;
      object-fit: cover;
    }
  </style>
</head>
<body>

<!-- ‚úÖ Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="{{ url_for('main.home') }}">üêÑ Livestock Market</a>

    <!-- üîç Search Form -->
 <form class="d-flex ms-3" method="GET" action="{{ url_for('main.home') }}">
      <input class="form-control me-2" type="search" name="q" placeholder="Search all products..." value="{{ request.args.get('search', '') }}">
      <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
 {% if promote_product %}
  <a href="{{ url_for('promotion.promote_product', product_id=promote_product.id) }}" class="nav-link">Promote Product</a>
{% endif %}


    <!-- Nav Links -->
<!-- Nav Links -->
<div class="collapse navbar-collapse justify-content-end">
  <ul class="navbar-nav">
    {% if current_user.is_authenticated %}
      <li class="nav-item">
        {% if current_user.is_admin %}
          <a class="nav-link" href="{{ url_for('admin.admin_dashboard') }}">Admin Dashboard</a>
        {% elif current_user.role == 'agent' %}
          <a class="nav-link" href="{{ url_for('agents.agent_dashboard') }}">My Profile</a>
        {% elif current_user.role == 'vet' %}
          <a class="nav-link" href="{{ url_for('vets.vet_dashboard') }}">My Profile</a>
        {% elif current_user.role == 'logistics' %}
          <a class="nav-link" href="{{ url_for('logistics.logistics_dashboard') }}">My Profile</a>
        {% elif current_user.role in ['buyer', 'seller'] %}
          <a class="nav-link" href="{{ url_for('seller_dashboard.my_dashboard') }}">My Profile</a>
        {% endif %}
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
      </li>
    {% else %}
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.login') }}">Sign In</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('auth.register') }}">Register</a>
      </li>
    {% endif %}
  </ul>
</div>
  </div></nav>

<!-- ‚úÖ Main Content -->
<div class="container-fluid mt-4">
  <div class="row">

    <!-- ‚úÖ Sidebar Filters -->
    <div class="col-md-3">
      <div class="sidebar">
        <form method="GET">
          <h5 class="mb-3">Filter Products</h5>

          <!-- Category -->
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select name="category" class="form-select">
  {% set selected_category = request.args.get('category') %}
 <option value="">All Categories</option>
<option value="cattle" {% if selected_category == 'cattle' %}selected{% endif %}>Cattle</option>
<option value="goats" {% if selected_category == 'goats' %}selected{% endif %}>Goats</option>
<option value="pig" {% if selected_category == 'pig' %}selected{% endif %}>Pig</option>
<option value="poultry" {% if selected_category == 'poultry' %}selected{% endif %}>Poultry</option>
<option value="equipment" {% if selected_category == 'equipment' %}selected{% endif %}>Farming Equipment</option>

<option value="Livestock Transport & Logistics" {% if selected_category == 'Livestock Transport & Logistics' %}selected{% endif %}>Livestock Transport & Logistics</option>
<option value="Animal Housing & Shelters" {% if selected_category == 'Animal Housing & Shelters' %}selected{% endif %}>Animal Housing & Shelters</option>
<option value="Fertilizers & Soil Amendments" {% if selected_category == 'Fertilizers & Soil Amendments' %}selected{% endif %}>Fertilizers & Soil Amendments</option>
<option value="Farm Produce" {% if selected_category == 'Farm Produce' %}selected{% endif %}>Farm Produce</option>
<option value="Farming Equipment & Tools {% if selected_category == 'Farming Equipment & Tools' %}selected{% endif %}>Farming Equipment & Tools</option>

<option value="Fish & Aquaculture" {% if selected_category == 'Fish & Aquaculture' %}selected{% endif %}>Fish & Aquaculture</option>
<option value="Bees & Honey" {% if selected_category == 'Bees & Honey' %}selected{% endif %}>Bees & Honey</option>
<option value="Animal Feed & Supplements" {% if selected_category == 'Animal Feed & Supplements' %}selected{% endif %}>Animal Feed & Supplements</option>
<option value="Veterinary Products & Medicines" {% if selected_category == 'Veterinary Products & Medicines' %}selected{% endif %}>Veterinary Products & Medicines</option>
<option value="Sheep" {% if selected_category == 'Sheep' %}selected{% endif %}>Sheep</option>
<option value="Animal Breeding Services" {% if selected_category == 'Animal Breeding Services' %}selected{% endif %}>Animal Breeding Services</option>


 </select>
          </div>

          <!-- State -->
          <div class="mb-3">
             <label class="form-label">State</label>
           <select id="state" name="state"  class="form-select">
          <option value="">--Select State--</option>
          <option value="Abia">Abia</option>
          <option value="Adamawa">Adamawa</option>
          <option value="Akwa Ibom">Akwa Ibom</option>
          <option value="Anambra">Anambra</option>
          <option value="Bauchi">Bauchi</option>
          <option value="Bayelsa">Bayelsa</option>
          <option value="Benue">Benue</option>
          <option value="Borno">Borno</option>
          <option value="Cross River">Cross River</option>
          <option value="Delta">Delta</option>
          <option value="Ebonyi">Ebonyi</option>
          <option value="Edo">Edo</option>
          <option value="Ekiti">Ekiti</option>
          <option value="Enugu">Enugu</option>
          <option value="Gombe">Gombe</option>
          <option value="Imo">Imo</option>
          <option value="Jigawa">Jigawa</option>
          <option value="Kaduna">Kaduna</option>
          <option value="Kano">Kano</option>
          <option value="Katsina">Katsina</option>
          <option value="Kebbi">Kebbi</option>
          <option value="Kogi">Kogi</option>
          <option value="Kwara">Kwara</option>
          <option value="Lagos">Lagos</option>
          <option value="Nasarawa">Nasarawa</option>
          <option value="Niger">Niger</option>
          <option value="Ogun">Ogun</option>
          <option value="Ondo">Ondo</option>
          <option value="Osun">Osun</option>
          <option value="Oyo">Oyo</option>
          <option value="Plateau">Plateau</option>
          <option value="Rivers">Rivers</option>
          <option value="Sokoto">Sokoto</option>
          <option value="Taraba">Taraba</option>
          <option value="Yobe">Yobe</option>
          <option value="Zamfara">Zamfara</option>
          <option value="FCT">FCT</option>
        </select>
          </div>

          <!-- City -->
          <div class="mb-3">
            <label class="form-label">City / LGA</label>
            <select id="city" name="city"  class="form-select">
          <option value="">--Select LGA--</option>
        </select>
          </div>

          <!-- Price Range -->
          <div class="mb-3">
            <label class="form-label">Min Price</label>
            <input type="number" name="min_price" class="form-control" placeholder="‚Ç¶ Min"
              value="{{ request.args.get('min_price', '') }}">
          </div>
          <div class="mb-3">
            <label class="form-label">Max Price</label>
            <input type="number" name="max_price" class="form-control" placeholder="‚Ç¶ Max"
              value="{{ request.args.get('max_price', '') }}">
          </div>

          <!-- Search Field -->
          <div class="mb-3">
            <label class="form-label">Search</label>
            <input type="text" name="search" class="form-control" placeholder="Search products"
              value="{{ request.args.get('search', '') }}">
          </div>

          <!-- Buttons -->
          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary">Apply Filters</button>
            <a href="{{ url_for('main.home') }}" class="btn btn-secondary">Reset</a>
          </div>
        </form>
      </div>
    </div>
<div class="col-md-9">
  <div class="row g-4">

    {% for product in products %}
      <div class="col-md-4 col-lg-3">
        <div class="card h-100 shadow-sm border-0 product-card rounded-4 position-relative">

          <!-- Product Image -->
          <div class="position-relative">
            {% if product.photos and product.photos[0] %}
              <img src="{{ url_for('static', filename=product.photos[0].split('static/')[-1]) }}"
                   class="card-img-top product-img rounded-top" alt="{{ product.title }}">
            {% else %}
              <img src="{{ url_for('static', filename='default.jpg') }}"
                   class="card-img-top product-img rounded-top" alt="No image">
            {% endif %}

            <!-- üî• Promotion Badges Top-Right -->
            {% if product.is_featured and product.featured_expiry and product.featured_expiry > now %}
              <div class="position-absolute top-0 end-0 bg-warning text-dark fw-bold px-2 py-1 rounded-bottom-start z-1"
                   data-bs-toggle="tooltip" title="Featured Product">üåü</div>
            {% elif product.is_top and product.top_expiry and product.top_expiry > now %}
              <div class="position-absolute top-0 end-0 bg-success text-white fw-bold px-2 py-1 rounded-bottom-start z-1"
                   data-bs-toggle="tooltip" title="Top Product">üìå</div>
            {% elif product.is_boosted and product.boosted_expiry and product.boosted_expiry > now %}
              <div class="position-absolute top-0 end-0 bg-info text-white fw-bold px-2 py-1 rounded-bottom-start z-1"
                   data-bs-toggle="tooltip" title="Boosted for visibility">üöÄ</div>
            {% endif %}
          </div>

          <!-- Card Body -->
          <div class="card-body d-flex flex-column">
            <h6 class="fw-bold text-truncate">{{ product.title }}</h6>

            <!-- üè∑Ô∏è Promotion Label Top-Left -->
            {% if product.is_featured and product.featured_expiry and product.featured_expiry > now %}

              <div class="position-absolute top-0 start-0 bg-warning text-dark fw-bold px-2 py-1 rounded-end z-1">üåü Featured</div>
            {% elif product.is_top and product.top_expiry and product.top_expiry > now %}
              <div class="position-absolute top-0 start-0 bg-success text-white fw-bold px-2 py-1 rounded-end z-1">üìå Top</div>
            {% elif product.is_boosted and product.boosted_expiry and product.boosted_expiry > now %}
              <div class="position-absolute top-0 start-0 bg-info text-white fw-bold px-2 py-1 rounded-end z-1">üöÄ Boosted</div>
            {% endif %}

            <small class="text-muted mb-1">
              üìÖ {{ product.created_at.strftime('%b %d, %Y') }}<br>
              üìç {{ product.state }}, {{ product.city }}
            </small>

            <p class="price mt-2 mb-1">‚Ç¶{{ "{:,.2f}".format(product.price) }}</p>
            <small class="text-muted">Negotiable: {{ product.open_to_negotiation|capitalize }}</small>

            {% if product.user %}
              <small class="mt-2 text-muted">
                üë§ {{ product.user.first_name }} {{ product.user.last_name }}
                {% if product.user.is_verified %}
                  <i class="fas fa-check-circle text-success" data-bs-toggle="tooltip" title="Verified Seller"></i>
                {% endif %}
              </small>
            {% endif %}

            {% if product.user and product.user.is_verified %}
              <div class="mt-2">
                <span class="badge bg-success" data-bs-toggle="tooltip" title="Verified seller">‚úÖ Verified</span>
              </div>
            {% endif %}

            <!-- Buttons -->
            <div class="mt-auto d-flex flex-column gap-2 mt-3">
              {% if product.phone_display %}
                <a href="https://wa.me/{{ product.phone_display | replace('0', '234', 1) }}"
                   target="_blank" class="btn btn-sm btn-success w-100">üí¨ WhatsApp Seller</a>
              {% endif %}
              <a href="tel:{{ product.phone_display }}" class="btn btn-sm btn-outline-success w-100">üìû Call Seller</a>
              {% if product.user %}
                <a href="{{ url_for('chat.chat_with_user', receiver_id=product.user.id) }}"
                   class="btn btn-sm btn-outline-primary w-100">üí¨ Chat Seller</a>
              {% endif %}
              <a href="{{ url_for('seller_dashboard.product_detail', product_id=product.id) }}"
                 class="btn btn-sm btn-dark w-100">üîç View Details</a>
            </div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-12">
        <div class="alert alert-warning text-center">No products found for selected filters.</div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- ‚úÖ Auto-load LGAs Script -->
<script>
  const lgasByState = {
     "Abia": ["Aba North", "Aba South", "Arochukwu", "Bende", "Ikwuano", "Isiala Ngwa North", "Isiala Ngwa South", "Isuikwuato", "Obi Ngwa", "Ohafia", "Osisioma", "Ugwunagbo", "Ukwa East", "Ukwa West", "Umuahia North", "Umuahia South", "Umu Nneochi"],
  "Adamawa": ["Demsa", "Fufore", "Ganye", "Girei", "Gombi", "Guyuk", "Hong", "Jada", "Lamurde", "Madagali", "Maiha", "Mayo-Belwa", "Michika", "Mubi North", "Mubi South", "Numan", "Shelleng", "Song", "Toungo", "Yola North", "Yola South"],
  "Akwa Ibom": ["Abak", "Eastern Obolo", "Eket", "Esit Eket", "Essien Udim", "Etim Ekpo", "Etinan", "Ibeno", "Ibesikpo Asutan", "Ibiono-Ibom", "Ika", "Ikono", "Ikot Abasi", "Ikot Ekpene", "Ini", "Itu", "Mbo", "Mkpat-Enin", "Nsit-Atai", "Nsit-Ibom", "Nsit-Ubium", "Obot Akara", "Okobo", "Onna", "Oron", "Oruk Anam", "Udung-Uko", "Ukanafun", "Uruan", "Urue-Offong/Oruko", "Uyo"],
  "Anambra": ["Aguata", "Anambra East", "Anambra West", "Anaocha", "Awka North", "Awka South", "Ayamelum", "Dunukofia", "Ekwusigo", "Idemili North", "Idemili South", "Ihiala", "Njikoka", "Nnewi North", "Nnewi South", "Ogbaru", "Onitsha North", "Onitsha South", "Orumba North", "Orumba South", "Oyi"],
  "Bauchi": ["Alkaleri", "Bauchi", "Bogoro", "Damban", "Darazo", "Dass", "Gamawa", "Ganjuwa", "Giade", "Itas/Gadau", "Jama'are", "Katagum", "Kirfi", "Misau", "Ningi", "Shira", "Tafawa Balewa", "Toro", "Warji", "Zaki"],
  "Bayelsa": ["Brass", "Ekeremor", "Kolokuma/Opokuma", "Nembe", "Ogbia", "Sagbama", "Southern Ijaw", "Yenagoa"],
  "Benue": ["Ado", "Agatu", "Apa", "Buruku", "Gboko", "Guma", "Gwer East", "Gwer West", "Katsina-Ala", "Konshisha", "Kwande", "Logo", "Makurdi", "Obi", "Ogbadibo", "Ohimini", "Oju", "Okpokwu", "Otukpo", "Tarka", "Ukum", "Ushongo", "Vandeikya"],
  "Borno": ["Abadam", "Askira/Uba", "Bama", "Bayo", "Biu", "Chibok", "Damboa", "Dikwa", "Gubio", "Guzamala", "Gwoza", "Hawul", "Jere", "Kaga", "Kala/Balge", "Konduga", "Kukawa", "Kwaya Kusar", "Mafa", "Magumeri", "Maiduguri", "Marte", "Mobbar", "Monguno", "Ngala", "Nganzai", "Shani"],
  "Cross River": ["Abi", "Akamkpa", "Akpabuyo", "Bakassi", "Bekwarra", "Biase", "Boki", "Calabar Municipal", "Calabar South", "Etung", "Ikom", "Obanliku", "Obubra", "Obudu", "Odukpani", "Ogoja", "Yakurr", "Yala"],
  "Delta": ["Aniocha North", "Aniocha South", "Bomadi", "Burutu", "Ethiope East", "Ethiope West", "Ika North East", "Ika South", "Isoko North", "Isoko South", "Ndokwa East", "Ndokwa West", "Okpe", "Oshimili North", "Oshimili South", "Patani", "Sapele", "Udu", "Ughelli North", "Ughelli South", "Ukwuani", "Uvwie", "Warri North", "Warri South", "Warri South West"],
  "Ebonyi": ["Abakaliki", "Afikpo North", "Afikpo South", "Ebonyi", "Ezza North", "Ezza South", "Ikwo", "Ishielu", "Ivo", "Izzi", "Ohaozara", "Ohaukwu", "Onicha"],
  "Edo": ["Akoko-Edo", "Egor", "Esan Central", "Esan North-East", "Esan South-East", "Esan West", "Etsako Central", "Etsako East", "Etsako West", "Igueben", "Ikpoba-Okha", "Oredo", "Orhionmwon", "Ovia North-East", "Ovia South-West", "Owan East", "Owan West", "Uhunmwonde"],
  "Ekiti": ["Ado Ekiti", "Efon", "Ekiti East", "Ekiti South-West", "Ekiti West", "Emure", "Gbonyin", "Ido Osi", "Ijero", "Ikere", "Ikole", "Ilejemeje", "Irepodun/Ifelodun", "Ise/Orun", "Moba", "Oye"],
  "Enugu": ["Aninri", "Awgu", "Enugu East", "Enugu North", "Enugu South", "Ezeagu", "Igbo Etiti", "Igbo Eze North", "Igbo Eze South", "Isi Uzo", "Nkanu East", "Nkanu West", "Nsukka", "Oji River", "Udenu", "Udi", "Uzo Uwani"],
  "FCT": ["Abaji", "Bwari", "Gwagwalada", "Kuje", "Kwali", "Municipal Area Council"],
  "Gombe": ["Akko", "Balanga", "Billiri", "Dukku", "Funakaye", "Gombe", "Kaltungo", "Kwami", "Nafada", "Shongom", "Yamaltu/Deba"],
  "Imo": ["Aboh Mbaise", "Ahiazu Mbaise", "Ehime Mbano", "Ezinihitte", "Ideato North", "Ideato South", "Ihitte/Uboma", "Ikeduru", "Isiala Mbano", "Isu", "Mbaitoli", "Ngor Okpala", "Njaba", "Nkwerre", "Nwangele", "Obowo", "Oguta", "Ohaji/Egbema", "Okigwe", "Onuimo", "Orlu", "Orsu", "Oru East", "Oru West", "Owerri Municipal", "Owerri North", "Owerri West"],
  "Jigawa": ["Auyo", "Babura", "Biriniwa", "Birnin Kudu", "Buji", "Dutse", "Gagarawa", "Garki", "Gumel", "Guri", "Gwaram", "Gwiwa", "Hadejia", "Jahun", "Kafin Hausa", "Kaugama", "Kazaure", "Kiri Kasama", "Kiyawa", "Maigatari", "Malam Madori", "Miga", "Ringim", "Roni", "Sule Tankarkar", "Taura", "Yankwashi"],
  "Kaduna": ["Birnin Gwari", "Chikun", "Giwa", "Igabi", "Ikara", "Jaba", "Jema'a", "Kachia", "Kaduna North", "Kaduna South", "Kagarko", "Kajuru", "Kaura", "Kauru", "Kubau", "Kudan", "Lere", "MakarfI", "Sabon Gari", "Sanga", "Soba", "Zangon Kataf", "Zaria"],
  "Kano": ["Ajingi", "Albasu", "Bagwai", "Bebeji", "Bichi", "Bunkure", "Dala", "Dambatta", "Dawakin Kudu", "Dawakin Tofa", "Doguwa", "Fagge", "Gabasawa", "Garko", "Garun Mallam", "Gaya", "Gezawa", "Gwale", "Gwarzo", "Kabo", "Kano Municipal", "Karaye", "Kibiya", "Kiru", "Kumbotso", "Kunchi", "Kura", "Madobi", "Makoda", "Minjibir", "Nasarawa", "Rano", "Rimin Gado", "Rogo", "Shanono", "Sumaila", "Takai", "Tarauni", "Tofa", "Tsanyawa", "Tudun Wada", "Ungogo", "Warawa", "Wudil"],
  "Katsina": ["Bakori", "Batagarawa", "Batsari", "Baure", "Bindawa", "Charanchi", "Dandume", "Danja", "Daura", "Dutsi", "Dutsin-Ma", "Faskari", "Funtua", "Ingawa", "Jibia", "Kafur", "Kaita", "Kankara", "Kankia", "Katsina", "Kurfi", "Kusada", "Mai'Adua", "Malumfashi", "Mani", "Mashi", "Matazu", "Musawa", "Rimi", "Sabuwa", "Safana", "Sandamu", "Zango"],
  "Kebbi": ["Aleiro", "Arewa Dandi", "Argungu", "Augie", "Bagudo", "Birnin Kebbi", "Bunza", "Dandi", "Fakai", "Gwandu", "Jega", "Kalgo", "Koko/Besse", "Maiyama", "Ngaski", "Sakaba", "Shanga", "Suru", "Wasagu/Danko", "Yauri", "Zuru"],
  "Kogi": ["Adavi", "Ajaokuta", "Ankpa", "Bassa", "Dekina", "Ibaji", "Idah", "Igalamela-Odolu", "Ijumu", "Kabba/Bunu", "Kogi", "Lokoja", "Mopa-Muro", "Ofu", "Ogori/Magongo", "Okehi", "Okene", "Olamaboro", "Omala", "Yagba East", "Yagba West"],
  "Kwara": ["Asa", "Baruten", "Edu", "Ekiti", "Ifelodun", "Ilorin East", "Ilorin South", "Ilorin West", "Irepodun", "Isin", "Kaiama", "Moro", "Offa", "Oke Ero", "Oyun", "Pategi"],
  "Lagos": ["Agege", "Ajeromi-Ifelodun", "Alimosho", "Amuwo-Odofin", "Apapa", "Badagry", "Epe", "Eti-Osa", "Ibeju-Lekki", "Ifako-Ijaiye", "Ikeja", "Ikorodu", "Kosofe", "Lagos Island", "Lagos Mainland", "Mushin", "Ojo", "Oshodi-Isolo", "Shomolu", "Surulere"],
  "Nasarawa": ["Akwanga", "Awe", "Doma", "Karu", "Keana", "Keffi", "Kokona", "Lafia", "Nasarawa", "Nasarawa Egon", "Obi", "Toto", "Wamba"],
  "Niger": ["Agaie", "Agwara", "Bida", "Borgu", "Bosso", "Chanchaga", "Edati", "Gbako", "Gurara", "Katcha", "Kontagora", "Lapai", "Lavun", "Magama", "Mariga", "Mashegu", "Mokwa", "Muya", "Paikoro", "Rafi", "Rijau", "Shiroro", "Suleja", "Tafa", "Wushishi"],
  "Ogun": ["Abeokuta North", "Abeokuta South", "Ado-Odo/Ota", "Egbado North", "Egbado South", "Ewekoro", "Ifo", "Ijebu East", "Ijebu North", "Ijebu North East", "Ijebu Ode", "Ikenne", "Imeko Afon", "Ipokia", "Obafemi Owode", "Odeda", "Odogbolu", "Ogun Waterside", "Remo North", "Sagamu"],
  "Ondo": ["Akoko North-East", "Akoko North-West", "Akoko South-East", "Akoko South-West", "Akure North", "Akure South", "Ese-Odo", "Idanre", "Ifedore", "Ilaje", "Ile Oluji/Okeigbo", "Irele", "Odigbo", "Okitipupa", "Ondo East", "Ondo West", "Ose", "Owo"],
  "Osun": ["Atakunmosa East", "Atakunmosa West", "Aiyedaade", "Aiyedire", "Boluwaduro", "Boripe", "Ede North", "Ede South", "Egbedore", "Ejigbo", "Ife Central", "Ife East", "Ife North", "Ife South", "Ifedayo", "Ifelodun", "Ila", "Ilesa East", "Ilesa West", "Irepodun", "Irewole", "Isokan", "Iwo", "Obokun", "Odo Otin", "Ola Oluwa", "Olorunda", "Oriade", "Orolu", "Osogbo"],
  "Oyo": ["Afijio", "Akinyele", "Atiba", "Atisbo", "Egbeda", "Ibadan North", "Ibadan North-East", "Ibadan North-West", "Ibadan South-East", "Ibadan South-West", "Ibarapa Central", "Ibarapa East", "Ibarapa North", "Ido", "Irepo", "Iseyin", "Itesiwaju", "Iwajowa", "Kajola", "Lagelu", "Ogbomosho North", "Ogbomosho South", "Ogo Oluwa", "Olorunsogo", "Oluyole", "Ona Ara", "Orelope", "Ori Ire", "Oyo", "Oyo East", "Saki East", "Saki West", "Surulere"],
  "Plateau": ["Barkin Ladi", "Bassa", "Bokkos", "Jos East", "Jos North", "Jos South", "Kanam", "Kanke", "Langtang North", "Langtang South", "Mangu", "Mikang", "Pankshin", "Qua‚Äôan Pan", "Riyom", "Shendam", "Wase"],
  "Rivers": ["Abua/Odual", "Ahoada East", "Ahoada West", "Akuku-Toru", "Andoni", "Asari-Toru", "Bonny", "Degema", "Eleme", "Emohua", "Etche", "Gokana", "Ikwerre", "Khana", "Obio/Akpor", "Ogba/Egbema/Ndoni", "Ogu/Bolo", "Okrika", "Omuma", "Opobo/Nkoro", "Oyigbo", "Port Harcourt", "Tai"],
  "Sokoto": ["Binji", "Bodinga", "Dange Shuni", "Gada", "Goronyo", "Gudu", "Gwadabawa", "Illela", "Isa", "Kebbe", "Kware", "Rabah", "Sabon Birni", "Shagari", "Silame", "Sokoto North", "Sokoto South", "Tambuwal", "Tangaza", "Tureta", "Wamako", "Wurno", "Yabo"],
  "Taraba": ["Ardo Kola", "Bali", "Donga", "Gashaka", "Gassol", "Ibi", "Jalingo", "Karim Lamido", "Kurmi", "Lau", "Sardauna", "Takum", "Ussa", "Wukari", "Yorro", "Zing"],
  "Yobe": ["Bade", "Bursari", "Damaturu", "Fika", "Fune", "Geidam", "Gujba", "Gulani", "Jakusko", "Karasuwa", "Machina", "Nangere", "Nguru", "Potiskum", "Tarmuwa", "Yunusari", "Yusufari"],
  "Zamfara": ["Anka", "Bakura", "Birnin Magaji/Kiyaw", "Bukkuyum", "Bungudu", "Gummi", "Gusau", "Kaura Namoda", "Maradun", "Maru", "Shinkafi", "Talata Mafara", "Chafe", "Zurmi"]

  };

  const stateSelect = document.getElementById("state");
  const citySelect = document.getElementById("city");

  stateSelect.addEventListener("change", function () {
    const selectedState = this.value;
    citySelect.innerHTML = '<option value="">--Select LGA--</option>';
    if (lgasByState[selectedState]) {
      lgasByState[selectedState].forEach(lga => {
        const option = document.createElement("option");
        option.value = lga;
        option.textContent = lga;
        citySelect.appendChild(option);
      });
    }
  });

  // Load LGA if state and city were already selected
  window.addEventListener("DOMContentLoaded", () => {
    const selectedState = "{{ request.args.get('state') }}";
    const selectedCity = "{{ request.args.get('city') }}";
    if (selectedState && lgasByState[selectedState]) {
      lgasByState[selectedState].forEach(lga => {
        const option = document.createElement("option");
        option.value = lga;
        option.textContent = lga;
        if (lga === selectedCity) option.selected = true;
        citySelect.appendChild(option);
      });
    }
  });
</script>
<script>
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
</script>

 <script>
  {% if current_user.is_authenticated and current_user.role in ['agent', 'vet', 'logistics'] %}
  setInterval(() => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        fetch("/update-location", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            latitude: pos.coords.latitude,
            longitude: pos.coords.longitude
          })
        });
      });
    }
  }, 30000); // every 30 seconds
  {% endif %}

<script>
navigator.geolocation.getCurrentPosition(pos => {
  fetch('/update-location', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      latitude: pos.coords.latitude,
      longitude: pos.coords.longitude
    })
  }).then(res => {
    if (res.ok) {
      alert('üìç Location updated successfully!');
    } else {
      alert('‚ùå Failed to update location.');
    }
  });
});
</script>

</body>
</html>
