<form method="POST" action="{{ url_for('seller_dashboard.setup_payout') }}">
    {{ form.hidden_tag() }}

    <div>
        <label>Bank</label>
        {{ form.bank_name(class="form-control", id="bank_name") }}
    </div>

    <div>
        <label>Account Number</label>
        {{ form.account_number(class="form-control", id="account_number") }}
    </div>

    <div>
        <label>Account Name</label>
        {{ form.account_name(class="form-control", id="account_name", readonly=True) }}
    </div>

    <div>
        {{ form.submit(class="btn btn-primary") }}
    </div>
</form>

<script>
document.getElementById("account_number").addEventListener("blur", function () {
    const accountNumber = this.value;
    const bankCode = document.getElementById("bank_name").value;

    if (accountNumber.length === 10 && bankCode) {
        fetch("{{ url_for('seller_dashboard.resolve_account') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                account_number: accountNumber,
                bank_code: bankCode
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                document.getElementById("account_name").value = data.account_name;
            } else {
                alert("Failed to resolve account");
            }
        });
    }
});
</script>
