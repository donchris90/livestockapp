<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Chat</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        #messages {
            height: 400px;
            overflow-y: scroll;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 1rem;
        }
        .message {
            margin-bottom: 10px;
        }
        .message.sent {
            text-align: right;
            color: green;
        }
        .message.received {
            text-align: left;
            color: blue;
        }
    </style>
</head>
<body class="container mt-4">
    <h2>Welcome, {{ user.first_name }}!</h2>
    <h4>Real-Time Chat</h4>

    <div id="messages"></div>

    <form id="chat-form">
      <div class="input-group mb-3">
    <input type="text" id="messageInput" class="form-control" placeholder="Type a message...">

    <button class="btn btn-primary" type="button" onclick="handleSend()">Send</button>
          <button class="btn btn-outline-secondary"   type="button">ðŸ“Ž Upload</button>
</div>

<input type="file" id="fileInput" class="form-control" style="display:none">


    </form>

    <script>
     document.getElementById('uploadBtn').addEventListener('click', () => {
    document.getElementById('fileInput').click();
});


        const socket = io();
        const userId = {{ user.id }};
        const userName = "{{ user.first_name }}";

        const messagesBox = document.getElementById('messages');
        const chatForm = document.getElementById('chat-form');
        const input = document.getElementById('message-input');

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        // Display received messages
        socket.on('receive_message', (data) => {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(data.sender_id === userId ? 'sent' : 'received');
            const timestamp = new Date().toLocaleString();
div.innerHTML = `<strong>${senderName}:</strong> ${data.content}<br><small class="text-muted">${timestamp}</small>`;

            messagesBox.appendChild(messageDiv);
            messagesBox.scrollTop = messagesBox.scrollHeight;
        });

        // Send message
        chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const content = input.value.trim();
            if (content) {
                const messageData = {
                    sender_id: userId,
                    sender_name: userName,
                    content: content
                };
                socket.emit('send_message', messageData);
                input.value = '';
            }
        });


    </script>
</body>
</html>
